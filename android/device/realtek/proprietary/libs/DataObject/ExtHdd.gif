-- sqlite3 ext.db
-- INSERT id = (SELECT ifnull(max(id),0)+1 FROM Partition)

-- version 1 - New

CREATE TABLE tParameter (id INTEGER PRIMARY KEY, fKey TEXT, fValue BLOB);
INSERT INTO tParameter(fKey, fValue) VALUES('DB_VERSION', '1');
INSERT INTO tParameter(fKey, fValue) VALUES('DB_DEVELOP_VERSION', '2');
CREATE UNIQUE INDEX iParameter_1 ON tParameter(fKey ASC);

-- Hdd Files

CREATE TABLE Partition(
    partition_id NUMERIC,
    sequence_id NUMERIC,
    online_path TEXT,
    scan_phase NUMERIC DEFAULT 0,
    removed NUMERIC DEFAULT 0,
    Primary Key(partition_id,sequence_id)
);
CREATE TRIGGER fk_Partition_1
BEFORE DELETE ON Partition
FOR EACH ROW BEGIN
  DELETE from ExtHddFolder WHERE partition_id=OLD.partition_id;
  DELETE from AudioFieldSummary WHERE partition_id=OLD.partition_id;
END;

CREATE TABLE ExtHddFolder(
    id INTEGER PRIMARY KEY,
    partition_id NUMERIC,
    parent_folder_id NUMERIC,
    folder_type NUMERIC DEFAULT 1,
    play_file_id NUMERIC DEFAULT 0,
    folder_name TEXT COLLATE NOCASE,
    full_folder_name TEXT,
    video_count NUMERIC DEFAULT 0,
    photo_count NUMERIC DEFAULT 0,
    audio_count NUMERIC DEFAULT 0,
    play_times NUMERIC DEFAULT 0,
    last_play_time NUMERIC DEFAULT 0,
    ctime NUMERIC,    
    folder_type_checked NUMERIC DEFAULT 0,
    checked NUMERIC DEFAULT 1,
    order_asc NUMBER,
    crc NUMERIC
);
CREATE INDEX i_ExtHddFolder_1 ON ExtHddFolder(parent_folder_id);
CREATE INDEX i_ExtHddFolder_2 ON ExtHddFolder(folder_type,folder_name);
CREATE INDEX i_ExtHddFolder_3 ON ExtHddFolder(video_count);
CREATE INDEX i_ExtHddFolder_4 ON ExtHddFolder(photo_count);
CREATE INDEX i_ExtHddFolder_5 ON ExtHddFolder(audio_count);

CREATE TRIGGER fk_ExtHddFolder_1
BEFORE DELETE ON ExtHddFolder
FOR EACH ROW BEGIN
  DELETE from ExtHddFile WHERE partition_id=OLD.partition_id AND folder_id=OLD.id;
  DELETE from ExtHddFolder WHERE partition_id=OLD.partition_id AND parent_folder_id=OLD.id;
  DELETE from ExtHddFolderCollection WHERE parent_folder_id=OLD.id AND partition_id=OLD.partition_id;
  DELETE from ExtHddFolderCollection WHERE folder_id=OLD.id AND partition_id=OLD.partition_id;
END;

CREATE TABLE ExtHddFolderCollection(
    partition_id NUMERIC,
    parent_folder_id NUMERIC,
    folder_id NUMERIC,
    Primary Key(parent_folder_id,folder_id,partition_id)  
);
CREATE INDEX i_ExtHddFolderCollection_1 ON ExtHddFolderCollection(folder_id);

CREATE TABLE ExtHddFile(
    id INTEGER PRIMARY KEY,
    partition_id NUMERIC,
    folder_id NUMERIC,
    folder_order_asc NUMERIC,
    media_type NUMERIC,
    file_name TEXT COLLATE NOCASE,
    file_ext TEXT,
    file_size NUMERIC,
    ctime NUMERIC,
    mtime NUMERIC,
    mtime_date NUMERIC,
    mtime_year NUMERIC,
    play_times NUMERIC DEFAULT 0,
    last_play_time NUMERIC DEFAULT 0,
    bookmark BLOB,
    id3_charset NUMERIC,
    artist TEXT COLLATE NOCASE,
    genre_id NUMERIC,
    album TEXT COLLATE NOCASE,
    title TEXT,
    FComment TEXT,
    Fyear NUMERIC,
    track NUMERIC,
    thumbnail BLOB,
    thumbnail_id NUMERIC,
    photo_orientation NUMERIC DEFAULT 0,
    is_video NUMERIC DEFAULT 0,
    is_photo NUMERIC DEFAULT 0,
    is_audio NUMERIC DEFAULT 0,
    checked NUMERIC DEFAULT 1,
    crc NUMERIC
);
CREATE INDEX i_ExtHddFile_010 ON ExtHddFile(folder_id,file_name);
CREATE INDEX i_ExtHddFile_020 ON ExtHddFile(album,file_name);
CREATE INDEX rmi_ExtHddFile_021 ON ExtHddFile(album,ctime);
CREATE INDEX rmi_ExtHddFile_022 ON ExtHddFile(album,last_play_time);
CREATE INDEX rmi_ExtHddFile_023 ON ExtHddFile(album,play_times);
CREATE INDEX rmi_ExtHddFile_024 ON ExtHddFile(album,file_size);
CREATE INDEX i_ExtHddFile_030 ON ExtHddFile(Artist,file_name);
CREATE INDEX rmi_ExtHddFile_031 ON ExtHddFile(Artist,ctime);
CREATE INDEX rmi_ExtHddFile_032 ON ExtHddFile(Artist,last_play_time);
CREATE INDEX rmi_ExtHddFile_033 ON ExtHddFile(Artist,play_times);
CREATE INDEX rmi_ExtHddFile_034 ON ExtHddFile(Artist,file_size);
CREATE INDEX i_ExtHddFile_040 ON ExtHddFile(genre_id,file_name);
CREATE INDEX rmi_ExtHddFile_041 ON ExtHddFile(genre_id,ctime);
CREATE INDEX rmi_ExtHddFile_042 ON ExtHddFile(genre_id,last_play_time);
CREATE INDEX rmi_ExtHddFile_043 ON ExtHddFile(genre_id,play_times);
CREATE INDEX rmi_ExtHddFile_044 ON ExtHddFile(genre_id,file_size);
CREATE INDEX i_ExtHddFile_050 ON ExtHddFile(Fyear,file_name);
CREATE INDEX rmi_ExtHddFile_051 ON ExtHddFile(Fyear,ctime);
CREATE INDEX rmi_ExtHddFile_052 ON ExtHddFile(Fyear,last_play_time);
CREATE INDEX rmi_ExtHddFile_053 ON ExtHddFile(Fyear,play_times);
CREATE INDEX rmi_ExtHddFile_054 ON ExtHddFile(Fyear,file_size);
CREATE INDEX i_ExtHddFile_060 ON ExtHddFile(media_type,folder_id);
CREATE INDEX i_ExtHddFile_070 ON ExtHddFile(last_play_time);
CREATE INDEX i_ExtHddFile_080 ON ExtHddFile(is_video,file_name);
CREATE INDEX rmi_ExtHddFile_081 ON ExtHddFile(is_video,ctime);
CREATE INDEX rmi_ExtHddFile_082 ON ExtHddFile(is_video,last_play_time);
CREATE INDEX rmi_ExtHddFile_083 ON ExtHddFile(is_video,play_times);
CREATE INDEX rmi_ExtHddFile_084 ON ExtHddFile(is_video,file_size);
CREATE INDEX i_ExtHddFile_090 ON ExtHddFile(is_photo,file_name);
CREATE INDEX rmi_ExtHddFile_091 ON ExtHddFile(is_photo,ctime);
CREATE INDEX rmi_ExtHddFile_092 ON ExtHddFile(is_photo,last_play_time);
CREATE INDEX rmi_ExtHddFile_093 ON ExtHddFile(is_photo,play_times);
CREATE INDEX rmi_ExtHddFile_094 ON ExtHddFile(is_photo,file_size);
CREATE INDEX rmi_ExtHddFile_095 ON ExtHddFile(is_photo,mtime_date);
CREATE INDEX i_ExtHddFile_100 ON ExtHddFile(is_audio,file_name);
CREATE INDEX rmi_ExtHddFile_101 ON ExtHddFile(is_audio,ctime);
CREATE INDEX rmi_ExtHddFile_102 ON ExtHddFile(is_audio,last_play_time);
CREATE INDEX rmi_ExtHddFile_103 ON ExtHddFile(is_audio,play_times);
CREATE INDEX rmi_ExtHddFile_104 ON ExtHddFile(is_audio,file_size);
CREATE INDEX rmi_ExtHddFile_110 ON ExtHddFile(is_audio,folder_order_asc,file_name);

CREATE TRIGGER fk_ExtHddFile_1
BEFORE DELETE ON ExtHddFile
FOR EACH ROW BEGIN
  DELETE from PlayList2File WHERE partition_id=OLD.partition_id AND file_id=OLD.id;
END;

CREATE TABLE AudioFieldSummary(
    partition_id NUMERIC,
    mp_type NUMERIC,
    id3_charset NUMERIC,
    name TEXT COLLATE NOCASE,
    total_count NUMERIC,
    photo_id NUMERIC,
    Primary Key(mp_type,name,partition_id)  
);
CREATE TRIGGER fk_AudioFieldSummary_1 
BEFORE INSERT ON AudioFieldSummary
BEGIN
    SELECT CASE
        WHEN (SELECT partition_id FROM Partition WHERE partition_id = NEW.partition_id) IS NULL
        THEN RAISE(ABORT, 'Foreign Key Violation : AudioFieldSummary.partition_id not in Partition.partition_id')
    END;
END;

-- play list
CREATE TABLE PlayList2File(
    playlist_name TEXT not null,
    partition_id NUMERIC,
    file_id NUMERIC not null,
    media_type NUMERIC,
    Primary Key(playlist_name,partition_id,file_id)  
);

-- Genre
CREATE TABLE Genre(
    media_type NUMERIC,
    id NUMERIC,
    GName TEXT,
    GOrder NUMERIC,
    Primary Key(media_type,id)
);

INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  0,  'Blues',  0);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  1,  'Classic Rock',  1);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  2,  'Country',  2);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  3,  'Dance',  3);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  4,  'Disco',  4);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  5,  'Funk',  5);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  6,  'Grunge',  6);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  7,  'Hip-Hop',  7);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  8,  'Jazz',  8);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,  9,  'Metal',  9);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 10,  'New Age', 10);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 11,  'Oldies', 11);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 12,  'Other', 12);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 13,  'Pop', 13);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 14,  'R&B', 14);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 15,  'Rap', 15);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 16,  'Reggae', 16);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 17,  'Rock', 17);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 18,  'Techno', 18);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 19,  'Industrial', 19);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 20,  'Alternative', 20);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 21,  'Ska', 21);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 22,  'Death Metal', 22);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 23,  'Pranks', 23);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 24,  'Soundtrack', 24);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 25,  'Euro-Techno', 25);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 26,  'Ambient', 26);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 27,  'Trip-Hop', 27);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 28,  'Vocal', 28);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 29,  'Jazz+Funk', 29);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 30,  'Fusion', 30);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 31,  'Trance', 31);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 32,  'Classical', 32);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 33,  'Instrumental', 33);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 34,  'Acid', 34);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 35,  'House', 35);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 36,  'Game', 36);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 37,  'Sound Clip', 37);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 38,  'Gospel', 38);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 39,  'Noise', 39);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 40,  'AlternRock', 40);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 41,  'Bass', 41);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 42,  'Soul', 42);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 43,  'Punk', 43);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 44,  'Space', 44);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 45,  'Meditative', 45);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 46,  'Instrumental Pop', 46);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 47,  'Instrumental Rock', 47);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 48,  'Ethnic', 48);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 49,  'Gothic', 49);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 50,  'Darkwave', 50);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 51,  'Techno-Industrial', 51);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 52,  'Electronic', 52);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 53,  'Pop-Folk', 53);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 54,  'Eurodance', 54);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 55,  'Dream', 55);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 56,  'Southern Rock', 56);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 57,  'Comedy', 57);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 58,  'Cult', 58);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 59,  'Gangsta', 59);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 60,  'Top 40', 60);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 61,  'Christian Rap', 61);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 62,  'Pop/Funk', 62);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 63,  'Jungle', 63);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 64,  'Native American', 64);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 65,  'Cabaret', 65);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 66,  'New Wave', 66);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 67,  'Psychadelic', 67);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 68,  'Rave', 68);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 69,  'Showtunes', 69);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 70,  'Trailer', 70);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 71,  'Lo-Fi', 71);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 72,  'Tribal', 72);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 73,  'Acid Punk', 73);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 74,  'Acid Jazz', 74);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 75,  'Polka', 75);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 76,  'Retro', 76);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 77,  'Musical', 77);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 78,  'Rock & Roll', 78);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 79,  'Hard Rock', 79);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 80,  'Folk', 80);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 81,  'Folk-Rock', 81);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 82,  'National Folk', 82);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 83,  'Swing', 83);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 84,  'Fast Fusion', 84);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 85,  'Bebob', 85);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 86,  'Latin', 86);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 87,  'Revival', 87);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 88,  'Celtic', 88);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 89,  'Bluegrass', 89);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 90,  'Avantgarde', 90);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 91,  'Gothic Rock', 91);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 92,  'Progressive Rock', 92);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 93,  'Psychedelic Rock', 93);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 94,  'Symphonic Rock', 94);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 95,  'Slow Rock', 95);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 96,  'Big Band', 96);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 97,  'Chorus', 97);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 98,  'Easy Listening', 98);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1, 99,  'Acoustic', 99);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,100,  'Humour',100);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,101,  'Speech',101);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,102,  'Chanson',102);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,103,  'Opera',103);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,104,  'Chamber Music',104);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,105,  'Sonata',105);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,106,  'Symphony',106);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,107,  'Booty Bass',107);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,108,  'Primus',108);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,109,  'Porn Groove',109);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,110,  'Satire',110);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,111,  'Slow Jam',111);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,112,  'Club',112);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,113,  'Tango',113);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,114,  'Samba',114);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,115,  'Folklore',115);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,116,  'Ballad',116);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,117,  'Power Ballad',117);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,118,  'Rhythmic Soul',118);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,119,  'Freestyle',119);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,120,  'Duet',120);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,121,  'Punk Rock',121);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,122,  'Drum Solo',122);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,123,  'A capella',123);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,124,  'Euro-House',124);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,125,  'Dance Hall',125);
INSERT INTO Genre(media_type,id,GName,GOrder) VALUES(1,1000,  'Others',1000);

-- selected 

CREATE TABLE FileSelected(
    partition_id NUMERIC,
    file_id NUMERIC
);

-- version control

CREATE TABLE DB_VERSION_CONTROL(
    id INTEGER PRIMARY KEY,
    Version NUMERIC,
    CmdOrder NUMERIC,
    CmdSQL TEXT
);

INSERT INTO DB_VERSION_CONTROL(Version,CmdOrder,CmdSQL) VALUES(1,1,"BUILDNEW");

-- End of SQL Schema
VACUUM;

.quit
